# Потенциал

## Базовая формула
V(r) = k Σᵢ qᵢ / |r - rᵢ|

Обычно k = 1 для визуализации.

## Численная стабилизация
Вместо |r - rᵢ| используем sqrt( (Δx)^2 + (Δy)^2 + ε² ), где ε ~ 0.5..2 (зависит от масштаба).

## Компрессия динамического диапазона
При больших |V| карта быстро «выгорает» (всё становится белым/красным). Применяем:
Vc = sign(V) * log(1 + a|V|) / log(1 + a Vmax)

Где:
- a > 0 — коэффициент (например 0.5..4).
- Vmax — оценка максимального |V| (либо адаптивная).

## Адаптивное Vmax
1. Несколько пробных пикселей (семплирование) → находить локальный максимум.
2. Экспоненциальное сглаживание:
   Vmax_new = max( lerp(Vmax_old, V_observed, α), VminFloor )

## Нормирование координат
Если визуальный простор — пиксели, для физической интерпретации имеет смысл нормализовать координаты:
(x_ph, y_ph) = ( (x - W/2) / scale, (y - H/2) / scale )

## Сложность
O(N_pixels * N_charges).

## Оптимизация (предвычисление)
- Создать текстуру потенциала и обновлять только при изменении зарядов.
- Для плавного редактирования (drag) всё равно нужна частая пересборка, но можно понижать разрешение во время перемещения (progressive refinement).

---

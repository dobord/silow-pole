# UI: Сценарии и состояния

## Состояния
| State | Описание |
|-------|----------|
| Idle | Нет активных операций |
| SelectingCharge | Выбор заряда для редактирования |
| DraggingCharge | Перемещение заряда |
| EditingValue | Изменение величины q |
| AddingCharge | Добавление нового заряда |
| RemovingCharge | Удаление выбранного |
| TogglingLayers | Переключение визуальных слоёв |
| EditingIsoLevels | Управление эквипотенциалами |

## Сценарии

### Добавление
1. Кнопка «Добавить».
2. Клик по холсту → координаты → новый charge.
3. Окно/панель ввода q.
4. Автоперерисовка.

### Перемещение
1. Mousedown на маркере.
2. Mousemove → обновление (x,y).
3. Mouseup → фиксируем.

### Изменение q
1. Выбор в списке или кликом.
2. Ползунок/числовое поле → запись в map.mQ[i].q.
3. Ререндер.

### Удаление
1. Выбор.
2. Delete → подтверждение → splice.

### Переключение слоёв
- show_q_switch → отображение маркеров.
- show_line_switch → рендер силовых линий.

### Эквипотенциалы (план)
- Список уровней.
- Добавить/удалить уровень.
- Переключатель «Показать».

## Координатные преобразования
```
mousePixel → logical
x_logic = (mouseX - W/2)/scale
y_logic = (H/2 - mouseY)/scale   // инверсия Y
```

## Ошибки UX и меры
| Проблема | Решение |
|----------|---------|
| Затруднён drag | Увеличить hit radius |
| Слишком легко добавить лишний заряд | Режим Add с явным включением |
| Перегруженность линиями | Лимит seeds или кластеризация |

---

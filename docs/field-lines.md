# Линии напряженности

## Формула поля
E(r) = Σᵢ qᵢ (r - rᵢ) / |r - rᵢ|³  (k=1)

## Интегрирование
Простейшее: Euler:
```
p_{n+1} = p_n + h * Ê(p_n)
```

Лучше: RK4:
```
k1 = f(p)
k2 = f(p + h*k1/2)
k3 = f(p + h*k2/2)
k4 = f(p + h*k3)
p_{n+1} = p + (h/6)*(k1 + 2k2 + 2k3 + k4)
```
где f(p)=Ê(p).

## Seed-позиции
- Окружность радиуса r0 вокруг каждого положительного заряда (исходящие линии).
- Можно добавить вокруг отрицательных (для «входящих») — направление зависит от знака.

## Критерии остановки
- p выходит за границы.
- |E| < E_min.
- Попали в окрестность (радиус captureR) противоположного заряда.
- MaxSteps.

## Адаптивный шаг
```
h_eff = clamp( h0 / (1 + β|E|), h_min, h_max )
```

## Вывод
Линия → массив вершин → VBO → drawArrays(LINE_STRIP).

## Возможные GPU решения
- WebGPU compute: многопоточность для множества seeds.
- Сжатый вывод: хранить count + массив координат фиксированной длины; mask для «ранней» остановки.

## Оптимизация
- Кэширование E на регулярной сетке и билинейная интерполяция.
- Прекращение генерации линии, если она слишком близко к уже существующей (минимизация избыточности).

---
